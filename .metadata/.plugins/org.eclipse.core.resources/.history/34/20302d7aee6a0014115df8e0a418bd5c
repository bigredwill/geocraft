package com.WeerdSalmon.LatLngSpwn;

import java.io.IOException;
import java.io.InputStream;
import java.io.UnsupportedEncodingException;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLConnection;
import java.net.URLEncoder;

import org.bukkit.plugin.Plugin;

public class LocationFinder {
	private Plugin plug;
	
	// Append IP to get location information
	private String telizeUrl = "http://www.telize.com/geoip/";
	// Append address, zipcode, or lat/lng
	private String googleUrl = "https://maps.googleapis.com/maps/api/geocode/json?address=";

	public double scale;
	public MinecraftCoordinate home;
	
	
	//	Latitude: 1 deg = 110.54 km = 110540 m;
	//	Longitude: 1 deg = 111.320*cos(latitude) km
	
	public LocationFinder(Plugin p) {
		this.plug = p;

	}
	
	public void setHome(MinecraftCoordinate mc, GeoCoordinate gc) {
		
	}
	
	
	public GeoCoordinate getRealWorldLocation(MinecraftCoordinate mc){
		
		
		
		
		
		return null;
		
	}
	public MinecraftCoordinate getGameLocation(String ip) {

		float latitude = 1;
		float longitude = 1;

		String url = telizeUrl;
		String charset = "UTF-8";
		String param1 = ip;
		String query = "";
		try {
			query = String.format("%s",
					URLEncoder.encode(param1, charset));
		} catch (UnsupportedEncodingException e) {
			System.out
					.println("Something went wrong with encoding URL, Location Finder");
			e.printStackTrace();
		}

		URLConnection connection = null;
		try {
			connection = new URL(url + "?" + query).openConnection();
		} catch (IOException e) {
			
			e.printStackTrace();
		}
		connection.setRequestProperty("Accept-Charset", charset);
		try {
			InputStream response = connection.getInputStream();

			plug.getLogger().info(response.toString());
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		return CoordinateConverter.geoToMineCraftCoordinate(new GeoCoordinate(
				latitude, longitude));

	}

}
